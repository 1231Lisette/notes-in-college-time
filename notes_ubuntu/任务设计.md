redbook record

lerobot smolvla为什么弱

500M 版本：

- 测试了一下，结果识别到刀和叉，但实际只有叉。 
- 换了一个更加多物体的图片，500M 版本直接疯了。  那当 500M版本的 VLA 抓取的时候，也就无法定位哪个是刀了。  
- 换了一个 SmolVLM2.2B 版本的，识别多物体仍然有丢失的物体。  
- 大家也可以用LM Studio 测试一下不同 Backbone 自身的识别能力，苹果和Ubuntu 都可以  
- 我觉得VLM 规模应该有一个底线，参数太低反而误导action

---

训练的是记得调bs

---

机械臂抖动问题

解决了各位 我用的是Lerobot0.4.1

你在train的时候让你选择policy.path需要加载一下 smolvla_base 也就是官方的权重模型 

当时我没有指定 只使用policy_type只有一个空架子

所以才有问题 今中午试验成功了

> wtf type和path不一样吗

---

疑问： 

1. 推理如何知道任务结束的？ 
2. 数据集质量/数量对这几种policy分别有哪些影响？改如何采集高质量数据（如何选择randomization等）？
3. 数据采集和推理时的相机位置/视角不一致，会有影响吗？
4. pi0部署推理使用远程GPU，有没有现成的code？
5. 推理测试，如何加入语音控制？

---

低配多任务训练

设备：2个640*480相机，腕部handeye+侧边俯视fixed

1. pick the black tape and place it on  the pink plate
2. pick the banana and place it on  the pink plate

盘子固定位置

15组only tape固定位置to plate

15组only 固定方向banana固定位置to plate

15组桌上有两个水果，都是1和2的固定位置，但是抓apple to plate（固定方向banana）

15组桌上有两个水果，都是1和2的固定位置，但是抓banana to plate（固定方向banana）

10组only banana但是方向变化，位置固定to plate

10组桌上有两个水果，都是1和2的固定位置，但是抓banana to plate（方向变化）

10组桌上有两个水果，都是1和2的固定位置，但是抓apple to plate（banana方向变化）

最后merge成90集的数据集，一起训练

100Ksteps来训练，每10k保存一个checkpoint

---

```shell
ls /dev/ttyACM*
```

```shell
sudo chmod 666 /dev/ttyACM*
```

---

lerobot v4.0.1

```shell
lerobot-find-cameras
```

Camera #2:
  Name: OpenCV Camera @ /dev/video4
  Type: OpenCV
  **Id: /dev/video4**
  Backend api: V4L2
  Default stream profile:
    Format: 0.0
    Fourcc: YUYV
    Width: 640
    Height: 480

Fps: 25.0

Camera #3:
  Name: OpenCV Camera @ /dev/video6
  Type: OpenCV
  **Id: /dev/video6**
  Backend api: V4L2
  Default stream profile:
    Format: 0.0
    Fourcc: YUYV
    Width: 640
    Height: 480

Fps: 25.0

---

尝试一下摇操作，同时开摄像头

```shell
lerobot-teleoperate \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{ front: {type: opencv, index_or_path: 4, width: 640, height: 480, fps: 25}, side: {type: opencv, index_or_path: 6, width: 640, height: 480, fps: 25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true
```

环境setup

图片*2

---

第一组 only banana 固定位置固定方向

图片*1

15 episode

收集数据命令

```bash
lerobot-record \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{'handeye': {'type':'opencv', 'index_or_path':4, 'width':640, 'height':480, 'fps':25}, 'fixed': {'type':'opencv', 'index_or_path':6, 'width':640, 'height':480, 'fps':25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true \
    --dataset.repo_id=Lisette1231/20251216so101_1 \
    --dataset.num_episodes=15 \
    --dataset.episode_time_s=60 \
    --dataset.reset_time_s=30 \
    --dataset.single_task="pick the yellow banana and place it on the pink plate" \
    --dataset.push_to_hub=true
```

---

第二组 only tape固定位置

图片*1 

```bash
lerobot-record \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{'handeye': {'type':'opencv', 'index_or_path':4, 'width':640, 'height':480, 'fps':25}, 'fixed': {'type':'opencv', 'index_or_path':6, 'width':640, 'height':480, 'fps':25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true \
    --dataset.repo_id=Lisette1231/20251216so101_2 \
    --dataset.num_episodes=15 \
    --dataset.episode_time_s=60 \
    --dataset.reset_time_s=30 \
    --dataset.single_task="pick the black tape and place it on the pink plate" \
    --dataset.push_to_hub=true
```

---

第三组 

图片*1

15组桌上有两个东西，都是1和2的固定位置，但是抓banana to plate（固定方向banana）

```bash
lerobot-record \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{'handeye': {'type':'opencv', 'index_or_path':4, 'width':640, 'height':480, 'fps':25}, 'fixed': {'type':'opencv', 'index_or_path':6, 'width':640, 'height':480, 'fps':25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true \
    --dataset.repo_id=Lisette1231/20251216so101_3 \
    --dataset.num_episodes=15 \
    --dataset.episode_time_s=60 \
    --dataset.reset_time_s=30 \
    --dataset.single_task="pick the yellow banana and place it on the pink plate" \
    --dataset.push_to_hub=true
```

---

第四组

图片*1

15组桌子上有两个东西，都是固定位置，但是抓tape to plate（固定方向banana）

```bash
lerobot-record \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{'handeye': {'type':'opencv', 'index_or_path':4, 'width':640, 'height':480, 'fps':25}, 'fixed': {'type':'opencv', 'index_or_path':6, 'width':640, 'height':480, 'fps':25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true \
    --dataset.repo_id=Lisette1231/20251216so101_4 \
    --dataset.num_episodes=15 \
    --dataset.episode_time_s=60 \
    --dataset.reset_time_s=30 \
    --dataset.single_task="pick the black tape and place it on the pink plate" \
    --dataset.push_to_hub=true
```

---

第5组

图片*

只有香蕉但是方向变化to plate

```bash
lerobot-record \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{'handeye': {'type':'opencv', 'index_or_path':4, 'width':640, 'height':480, 'fps':25}, 'fixed': {'type':'opencv', 'index_or_path':6, 'width':640, 'height':480, 'fps':25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true \
    --dataset.repo_id=Lisette1231/20251216so101_5 \
    --dataset.num_episodes=10 \
    --dataset.episode_time_s=60 \
    --dataset.reset_time_s=30 \
    --dataset.single_task="pick the yellow banana and place it on the pink plate" \
    --dataset.push_to_hub=true
```

---

第6组

10组桌上有两个，都是1和2的固定位置，但是抓banana to plate（方向变化）

```bash
lerobot-record \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{'handeye': {'type':'opencv', 'index_or_path':4, 'width':640, 'height':480, 'fps':25}, 'fixed': {'type':'opencv', 'index_or_path':6, 'width':640, 'height':480, 'fps':25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true \
    --dataset.repo_id=Lisette1231/20251216so101_6 \
    --dataset.num_episodes=10 \
    --dataset.episode_time_s=60 \
    --dataset.reset_time_s=30 \
    --dataset.single_task="pick the yellow banana and place it on the pink plate" \
    --dataset.push_to_hub=true
```



第7组

10组桌上有两个水果，都是1和2的固定位置，但是抓tape to plate（banana方向变化）

```bash
lerobot-record \
    --robot.type=so101_follower \
    --robot.port=/dev/ttyACM0 \
    --robot.id=R12253204 \
    --robot.cameras="{'handeye': {'type':'opencv', 'index_or_path':4, 'width':640, 'height':480, 'fps':25}, 'fixed': {'type':'opencv', 'index_or_path':6, 'width':640, 'height':480, 'fps':25}}" \
    --teleop.type=so101_leader \
    --teleop.port=/dev/ttyACM1 \
    --teleop.id=R07253204 \
    --display_data=true \
    --dataset.repo_id=Lisette1231/20251216so101_7 \
    --dataset.num_episodes=10 \
    --dataset.episode_time_s=60 \
    --dataset.reset_time_s=30 \
    --dataset.single_task="pick the black tape and place it on the pink plate" \
    --dataset.push_to_hub=true
```



---

合并数据集命令并上传

```bash
# Merge multiple datasets into a single dataset.
lerobot-edit-dataset \
    --repo_id Lisette1231/20251216so101_merged \
    --operation.type merge \
    --operation.repo_ids "['Lisette1231/20251216so101_1', 'Lisette1231/20251216so101_2','Lisette1231/20251216so101_2','Lisette1231/20251216so101_2','Lisette1231/20251216so101_3','Lisette1231/20251216so101_4','Lisette1231/20251216so101_5','Lisette1231/20251216so101_6','Lisette1231/20251216so101_7']"

hf upload Lisette1231/20251216so101_merged \
~/.cache/huggingface/lerobot/Lisette1231/20251216so101_merged \
--repo-type dataset

 
# 删除的
# Delete episodes and save to a new dataset (preserves original dataset)
lerobot-edit-dataset \
    --repo_id lerobot/pusht \
    --new_repo_id lerobot/pusht_after_deletion \
    --operation.type delete_episodes \
    --operation.episode_indices "[0, 2, 5]"
```

---

先给服务器挂个梯子

训练命令

```bash
lerobot-train \
  --dataset.repo_id=Lisette1231/20251216so101_merged \
  --policy.type=smolvla \
  --output_dir=outputs/train/20251216so101smolvla \
  --job_name=20251216so101smolvla \
  --policy.device=cuda \
  --wandb.enable=true \
  --policy.repo_id=Lisette1231/20251216so101smolvla \
  --policy.push_to_hub=true \
  --steps=100000 \
  --batch_size=32 \
  --save_freq=10000
```

下面这个没成功

```bash
  File "/home/omnisky/lerobot/src/lerobot/datasets/utils.py", line 381, in get_safe_version
    raise RevisionNotFoundError(
huggingface_hub.errors.RevisionNotFoundError: Your dataset must be tagged with a codebase version.
            Assuming _version_ is the codebase_version value in the info.json, you can run this:
            ```python
            from huggingface_hub import HfApi

            hub_api = HfApi()
            hub_api.create_tag("Lisette1231/20251216so101_merged", tag="_version_", repo_type="dataset")
            ```
            
(lerobot) omnisky@omnisky:~/lerobot$ python
Python 3.10.18 | packaged by conda-forge | (main, Jun  4 2025, 14:45:41) [GCC 13.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from huggingface_hub import HfApi
>>> 
>>> hub_api = HfApi()
>>> hub_api.create_tag(
...     "Lisette1231/20251216so101_merged",
...     tag="_version_",
...     repo_type="dataset"
... )
>>> 
>>> exit()

```

```bash
mkdir -p /home/omnisky/.cache/huggingface/lerobot/Lisette1231
```

```bash
#本地执行
scp -r /home/pyy/.cache/huggingface/lerobot/Lisette1231/20251216so101_merged \
    omnisky@10.24.3.58:/home/omnisky/.cache/huggingface/lerobot/Lisette1231

```

最好还是本地复制上去了

训练时服务器显存占用了大约7.4GB
