# 仿真环境

## 仿真环境的选择

1. gazebo
2. mujuco 
   1. 在接触动力学方面有高精度和高效率，是强化学习领域的常用工具
   2. 衍生出了多个学习框架，专为机器人操作任务设计的roborsuite，还有旨在简化sim-to-real流程的mojuco playground
   3. 但是主要依赖CPU进行多线程并行化，这对于需要大规模强化学习任务来说效率不高
3. **Issaclab与IssacSim**

如今常见的workflow是，在Issac这类支持GPU大规模并行加速的平台上进行训练，然后将在Mujoco中进行sim-to-sim实验以验证其物理真实性

> 然而，机器人仿真领域近期发展迅速。出现了基于lsaac Lab API和 MuJoCo 仿真的 MujocoLab，它能够利用 GPU加速在 MuJoCo 中的训练过程。同时，Isaac Sim 也推出了名为 Newton 的可微分仿真引擎。尽管技术在不断演进目前我们仍先学习主流的工具--lsaac Sim 和 lsaac Lab。



## Issac Sim与Issac lab

> 一个仿真软件实际上就在求解一个微分方程，在每一个离散时间上面进行所有机器人物理状态的表示。在仿真里面可以控制其迭代的微分方程计算的步长$$D_t$$，也可也它在多少帧之后会为我们渲染出一张图片然后输入给我们的显示器，让我们看到这个画面，即渲染步长

这两者属于层级关系：基础仿真平台Issac sim，以及构建于其上的机器人学习应用框架Issac lab

- issac sim：一个通用的机器人模拟器，提供了高保真的物理引擎（PhysX）和照片级别的渲染技术（RTX）。核心任务是构建和模拟一个精确、逼真的虚拟环境，包括机器人模型、传感器数据和物理交互
- issac lab：一个专为机器人学习（特别是rl）设计的开源框架。本身不是一个模拟器。而是利用issac sim提供的环境来进行大规模的ai训练。
  - coding 环境、奖励函数etc很方便，因为有模板

两者关系：Issac lab完全依赖于Issacsim，“在issac sim中构建，在issac lab中训练”



## 核心架构

<img src="\images\image5.png" alt="5" style="zoom:50%;" />

1. Application(App)：最高层级的管理者，负责所有资源的生命周期，包括启动和销毁仿真进程。即使用户在无头模式（headless）下运行，app依然是整个程序的总控制器

2. Simulation(Sim) ：负责定义虚拟世界的“规则”，例如物理定律（如重力方向），时间步长（dt）以及渲染频率。它将时间的每一步划分为不同的子步骤（like physics_step,render_step）

3. World 提供空间北京，定义笛卡尔坐标系的原点和单位。所以关于尺寸和距离的问题都在world参考系内得以解答

4. Stage 是世界的组成结构。它用通用场景描述（Universal Scene Description, USD）为基础，将仿真中所有元素（如机器人、灯光、摄像机）表示为一个层级化的树状结构。这个结构中每个节点都是一个图元（Prim）

   - USD图元（Primitive）：prim是usd场景的基本构建块，可以理解为一个容器。每个prim都有一个唯一的路径（例如/world/myrobot/gripper），并包含定义其特殊的属性（如颜色、大小）和与其它prim的关系（relationship）（如材质指定）

   - 例如一个“树”的prim可以有“高度”和“颜色”等属性，同时与一个“地面”prim建立关系，以表明种植位置。父级prim的属性可以被其子级继承，从而实现复杂的场景组合

5. Scene：是issaclab里面的重要概念，它管理着stage上所有向量化相关的图元，这些被管理的图元（如机器人、桌子、待抓取的物体）被称为仿真实体。当用户指定需要创建多个环境副本时候，scene会自动在stage上面克隆这些实体，并将他们放在不同的坐标位置，从而实现在单一世界和舞台上进行大规模的并行训练



总而言之，APP管理整个仿真进程，sim定义物理规则，world提供空间参考，stage通过USD图元组织场景结构，而scene则高效复制这些结构以加速学习



